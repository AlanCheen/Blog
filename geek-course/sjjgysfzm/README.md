# 《数据结构与算法之美》





### 01



### 02



### 03



### 04

### 05

### 06 07



### 08 栈



抽象型数据结构

后进先出

- `push` 

- `pop`



如何实现？

数组：

链表：



### 09 队列



**先进先出**（first in first out），抽象型数据结构，跟栈一样，也是一种**操作受限制的线性表数据结构**。

- `enqueue`  入队，放一个数据到队尾；

- `dequeue`   出队，从队头取一个数据。



拥有特性的队列：

- 循环队列
- 阻塞队列
- 并发队列



![img](http://ww3.sinaimg.cn/large/006tNc79ly1g54dl77a3wj30vq0m8dh5.jpg)



#### 顺序队列和链式队列

跟栈一样，队列可以用数组、链表来实现，用`数组`实现的叫**顺序队列**，用`链表`来实现的叫**链式队列**。



如何实现？

实现队列，需要两个指针，一个是 `head` 指针，指向队头；一个是 `tail` 指针，指向队尾。



**数组**的实现方式：

![img](http://ww2.sinaimg.cn/large/006tNc79ly1g5a1hqopmoj30vq0apjry.jpg)



数组的实现有个缺点，就是入队出队操作后，head tail 都会往后移动，这样当 tail 到最后的位置后就无法插入数据，而需要做**数据迁移**的操作。

数据迁移：当队列的 tail 移动到数组最右边时，如果有新的数据入队，则把整体的数据搬移到 0 到 tail-head 的位置。

![img](http://ww1.sinaimg.cn/large/006tNc79ly1g5a1n8mjkkj30vq0hrabx.jpg)

出队时间复杂度是 O(1)，但是入队就不是了。





**链表**的实现方式：

![img](http://ww4.sinaimg.cn/large/006tNc79ly1g5a1ib7s0hj30vq0hrjtq.jpg)



#### 循环队列

循环队列可以避免数据迁移的操作。

![img](http://ww1.sinaimg.cn/large/006tNc79ly1g5a1o50w0qj30vq0hrq4b.jpg)

当队满时，(tail+1)%n=head



#### 阻塞队列和并发队列



**阻塞队列**：在队列基础上增加了阻塞操作。在*队列为空*的时候，从队头*取数据*会被阻塞。因为此时没有数据可取，直到队列中有了数据才能返回；如果*队列满了*，那么*插入数据*就会被阻塞，直到队列中有空闲位置后再插入数据，然后再返回。

![img](http://ww4.sinaimg.cn/large/006tNc79ly1g5a0sc6mzzj30vp0dvt9t.jpg)



上面的定义就是一个“**生产者-消费者模型**”！可以使用阻塞队列实现一个生产者-消费者模型。

基于阻塞队列实现的方式可以有效地协调产生和消费的速度。当生产者生产数据的速度过快，消费者来不及消费的时候，队列快满了。这个时候，生产者就阻塞等待，直到消费者消费了数据，生产者才会被唤醒继续生产。



并且，基于阻塞队列，还能通过协调 生产者和消费者的个数，来提高数据的处理效率。如多配置消费者：

![img](http://ww4.sinaimg.cn/large/006tNc79ly1g5a0wjik8lj30vq0gndhi.jpg)



#### 如何实现**线程安全**的队列？

线程安全的队列叫做**并发队列**。

1. 最简单的方式：在 enqueue dequeue 方法上加锁，但是锁的粒度太大，并发度较低；
2. 基于数组的循环队列，利用 CAS 原子操作，可以实现非常高效的并发队列；



线程池没有空闲线程时，新的任务请求线程池资源时，线程池该如何处理？各种处理策略又是如何实现的呢？

处理策略：

1. **非阻塞**，直接拒绝任务请求；
2. **阻塞**，将请求存储起来排队，等到有空闲线程时，取出排队的请求继续处理。
   1. 如何存储排队的请求呢？
   2. 公平处理地处理每个请求，先进者先服务，可以用队列来存储排队的请求
      1. 基于**链表的支持无限排队的无界队列**（unbounded queue），但是可能会导致过多的请求排队等待，请求处理的响应时间过长。所以，针对响应时间比较敏感的系统，基于链表实现的无线排队的线程池是不合适的。
      2. 基于**数组的有界队列**（bounded queue），队列的大小有限，所以超过队列大小的请求会被拒绝，这种方式对响应时间敏感的系统相对更加合适。但是设置合理的队列大小就非常讲究了，太大会导致等待的请求太多，太小则会导致无法充分利用系统资源、发挥最大性能。



### 10 递归

